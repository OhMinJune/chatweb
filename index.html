<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>실시간 채팅 웹사이트 (정적 버전)</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <!-- 로그인 폼 -->
        <div id="loginForm" class="auth-container">
            <div class="auth-header">
                <h1>채팅 웹사이트</h1>
                <p>로그인하여 채팅을 시작하세요</p>
            </div>
            
            <form id="loginFormElement">
                <div class="form-group">
                    <label for="loginUsername">아이디</label>
                    <input type="text" id="loginUsername" name="username" required>
                </div>
                
                <div class="form-group">
                    <label for="loginPassword">비밀번호</label>
                    <input type="password" id="loginPassword" name="password" required>
                </div>
                
                <button type="submit" class="btn">로그인</button>
                
                <div class="auth-links">
                    <a href="#" onclick="showRegisterForm()">회원가입</a>
                </div>
                
                <div id="loginError" class="error-message hidden"></div>
            </form>
        </div>
        
        <!-- 회원가입 폼 -->
        <div id="registerForm" class="auth-container hidden">
            <div class="auth-header">
                <h1>회원가입</h1>
                <p>새 계정을 만들어보세요</p>
            </div>
            
            <form id="registerFormElement">
                <div class="form-group">
                    <label for="registerUsername">아이디</label>
                    <input type="text" id="registerUsername" name="username" required>
                </div>
                
                <div class="form-group">
                    <label for="registerPassword">비밀번호</label>
                    <input type="password" id="registerPassword" name="password" required>
                </div>
                
                <div class="form-group">
                    <label for="registerName">이름</label>
                    <input type="text" id="registerName" name="name" required>
                </div>
                
                <div class="form-group">
                    <label for="registerPhone">전화번호</label>
                    <input type="tel" id="registerPhone" name="phone" required>
                </div>
                
                <button type="submit" class="btn">회원가입</button>
                
                <div class="auth-links">
                    <a href="#" onclick="showLoginForm()">로그인으로 돌아가기</a>
                </div>
                
                <div id="registerError" class="error-message hidden"></div>
                <div id="registerSuccess" class="success-message hidden"></div>
            </form>
        </div>
    </div>

    <script>
        // 로컬 스토리지에서 사용자 데이터 관리
        class UserManager {
            constructor() {
                this.users = this.loadUsers();
                this.currentUser = this.loadCurrentUser();
            }

            loadUsers() {
                const users = localStorage.getItem('chatweb_users');
                if (!users) {
                    // 기본 사용자 데이터 생성
                    const defaultUsers = [
                        {
                            id: 1,
                            username: 'admin',
                            password: 'admin123', // 실제로는 해시화되어야 함
                            name: '관리자',
                            phone: '010-0000-0000',
                            role: 'admin'
                        },
                        {
                            id: 2,
                            username: 'guest1',
                            password: 'guest123',
                            name: '게스트1',
                            phone: '010-1111-1111',
                            role: 'guest'
                        }
                    ];
                    localStorage.setItem('chatweb_users', JSON.stringify(defaultUsers));
                    return defaultUsers;
                }
                return JSON.parse(users);
            }

            saveUsers() {
                localStorage.setItem('chatweb_users', JSON.stringify(this.users));
            }

            loadCurrentUser() {
                const user = localStorage.getItem('chatweb_current_user');
                return user ? JSON.parse(user) : null;
            }

            saveCurrentUser(user) {
                if (user) {
                    localStorage.setItem('chatweb_current_user', JSON.stringify(user));
                } else {
                    localStorage.removeItem('chatweb_current_user');
                }
                this.currentUser = user;
            }

            login(username, password) {
                const user = this.users.find(u => u.username === username && u.password === password);
                if (user) {
                    const { password, ...userWithoutPassword } = user;
                    this.saveCurrentUser(userWithoutPassword);
                    return { success: true, user: userWithoutPassword };
                }
                return { success: false, error: '아이디 또는 비밀번호가 일치하지 않습니다.' };
            }

            register(username, password, name, phone) {
                // 중복 사용자명 확인
                if (this.users.find(u => u.username === username)) {
                    return { success: false, error: '이미 존재하는 사용자명입니다.' };
                }

                const newUser = {
                    id: Date.now(), // 간단한 ID 생성
                    username,
                    password,
                    name,
                    phone,
                    role: 'guest'
                };

                this.users.push(newUser);
                this.saveUsers();
                return { success: true, message: '회원가입이 완료되었습니다.' };
            }

            logout() {
                this.saveCurrentUser(null);
            }
        }

        // 사용자 관리자 인스턴스 생성
        const userManager = new UserManager();

        // 폼 전환 함수
        function showLoginForm() {
            document.getElementById('loginForm').classList.remove('hidden');
            document.getElementById('registerForm').classList.add('hidden');
            clearMessages();
        }
        
        function showRegisterForm() {
            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('registerForm').classList.remove('hidden');
            clearMessages();
        }
        
        function clearMessages() {
            document.getElementById('loginError').classList.add('hidden');
            document.getElementById('registerError').classList.add('hidden');
            document.getElementById('registerSuccess').classList.add('hidden');
        }
        
        function showError(elementId, message) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.classList.remove('hidden');
        }
        
        function showSuccess(elementId, message) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.classList.remove('hidden');
        }
        
        // 로그인 처리
        document.getElementById('loginFormElement').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const username = formData.get('username');
            const password = formData.get('password');
            
            const result = userManager.login(username, password);
            
            if (result.success) {
                // 로그인 성공 시 해당 페이지로 리다이렉트
                if (result.user.role === 'admin') {
                    window.location.href = 'admin_static.html';
                } else {
                    window.location.href = 'chat_static.html';
                }
            } else {
                showError('loginError', result.error);
            }
        });
        
        // 회원가입 처리
        document.getElementById('registerFormElement').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const username = formData.get('username');
            const password = formData.get('password');
            const name = formData.get('name');
            const phone = formData.get('phone');
            
            const result = userManager.register(username, password, name, phone);
            
            if (result.success) {
                showSuccess('registerSuccess', result.message);
                // 2초 후 로그인 폼으로 전환
                setTimeout(() => {
                    showLoginForm();
                }, 2000);
            } else {
                showError('registerError', result.error);
            }
        });

        // 페이지 로드 시 이미 로그인된 사용자 확인
        window.addEventListener('load', () => {
            if (userManager.currentUser) {
                if (userManager.currentUser.role === 'admin') {
                    window.location.href = 'admin_static.html';
                } else {
                    window.location.href = 'chat_static.html';
                }
            }
        });
    </script>
</body>
</html>
