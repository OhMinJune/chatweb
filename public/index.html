<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>실시간 채팅 웹사이트</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <!-- 로그인 폼 -->
        <div id="loginForm" class="auth-container">
            <div class="auth-header">
                <h1>채팅 웹사이트</h1>
                <p>로그인하여 채팅을 시작하세요</p>
            </div>
            
            <form id="loginFormElement">
                <div class="form-group">
                    <label for="loginUsername">아이디</label>
                    <input type="text" id="loginUsername" name="username" required>
                </div>
                
                <div class="form-group">
                    <label for="loginPassword">비밀번호</label>
                    <input type="password" id="loginPassword" name="password" required>
                </div>
                
                <button type="submit" class="btn">로그인</button>
                
                <div class="auth-links">
                    <a href="#" onclick="showRegisterForm()">회원가입</a>
                </div>
                
                <div id="loginError" class="error-message hidden"></div>
            </form>
        </div>
        
        <!-- 회원가입 폼 -->
        <div id="registerForm" class="auth-container hidden">
            <div class="auth-header">
                <h1>회원가입</h1>
                <p>새 계정을 만들어보세요</p>
            </div>
            
            <form id="registerFormElement">
                <div class="form-group">
                    <label for="registerUsername">아이디</label>
                    <input type="text" id="registerUsername" name="username" required>
                </div>
                
                <div class="form-group">
                    <label for="registerPassword">비밀번호</label>
                    <input type="password" id="registerPassword" name="password" required>
                </div>
                
                <div class="form-group">
                    <label for="registerName">이름</label>
                    <input type="text" id="registerName" name="name" required>
                </div>
                
                <div class="form-group">
                    <label for="registerPhone">전화번호</label>
                    <input type="tel" id="registerPhone" name="phone" required>
                </div>
                
                <button type="submit" class="btn">회원가입</button>
                
                <div class="auth-links">
                    <a href="#" onclick="showLoginForm()">로그인으로 돌아가기</a>
                </div>
                
                <div id="registerError" class="error-message hidden"></div>
                <div id="registerSuccess" class="success-message hidden"></div>
            </form>
        </div>
    </div>

    <script>
        // 폼 전환 함수
        function showLoginForm() {
            document.getElementById('loginForm').classList.remove('hidden');
            document.getElementById('registerForm').classList.add('hidden');
            clearMessages();
        }
        
        function showRegisterForm() {
            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('registerForm').classList.remove('hidden');
            clearMessages();
        }
        
        function clearMessages() {
            document.getElementById('loginError').classList.add('hidden');
            document.getElementById('registerError').classList.add('hidden');
            document.getElementById('registerSuccess').classList.add('hidden');
        }
        
        function showError(elementId, message) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.classList.remove('hidden');
        }
        
        function showSuccess(elementId, message) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.classList.remove('hidden');
        }
        
        // 로그인 처리
        document.getElementById('loginFormElement').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const data = {
                username: formData.get('username'),
                password: formData.get('password')
            };
            
            try {
                const response = await fetch('/api/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    // 로그인 성공 시 해당 페이지로 리다이렉트
                    if (result.redirect === '/admin') {
                        window.location.href = '/webchat/admin';
                    } else if (result.redirect === '/chat') {
                        window.location.href = '/webchat/chat';
                    } else {
                        window.location.href = result.redirect;
                    }
                } else {
                    showError('loginError', result.error || '로그인에 실패했습니다.');
                }
            } catch (error) {
                console.error('로그인 오류:', error);
                showError('loginError', '서버 연결에 실패했습니다.');
            }
        });
        
        // 회원가입 처리
        document.getElementById('registerFormElement').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const data = {
                username: formData.get('username'),
                password: formData.get('password'),
                name: formData.get('name'),
                phone: formData.get('phone')
            };
            
            try {
                const response = await fetch('/api/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showSuccess('registerSuccess', result.message);
                    // 2초 후 로그인 폼으로 전환
                    setTimeout(() => {
                        showLoginForm();
                    }, 2000);
                } else {
                    showError('registerError', result.error || '회원가입에 실패했습니다.');
                }
            } catch (error) {
                console.error('회원가입 오류:', error);
                showError('registerError', '서버 연결에 실패했습니다.');
            }
        });
    </script>
</body>
</html>
